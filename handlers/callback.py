from sqlalchemy import select
from telebot import TeleBot, types
from sqlalchemy.orm import Session
from db.connect import engine
from db.models import BalanceTransfer, City, PayMetadata, Schedule, User
from datetime import datetime
from handlers.handler import get_list_refs, get_user_ref
from yookassa import Configuration, Payment
import uuid

from handlers.start import handle_start_message


SECRET_API = "live_8sy3urnb4lO3FxsGsaxANT4wC20ZMT97Fb-PAnCD7Sk"
SHOP_ID = 1124758

Configuration.configure(SHOP_ID, SECRET_API)

ADMIN_ACCOUNT = 6062822304
ADMIN_CHAT_ID = -1002837224902


def handler_callback(bot: TeleBot, call: types.CallbackQuery):
    with Session(engine) as session:
        user = session.execute(select(User).where(User.tg_id == call.from_user.id)).scalar() # call.from_user.id
        
        if call.data == "about_project":
            bot.send_message(call.from_user.id, """        
–ü—Ä–æ–µ–∫—Ç '–ó–∞ –ª—é–±–æ–≤—å' ‚Äî —ç—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω–∞—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞, —Å–æ–∑–¥–∞–Ω–Ω–∞—è –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å –∫—Ä–µ–ø–∫–∏–µ –∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è, —Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è –∫–∞–∫ –ª–∏—á–Ω–æ—Å—Ç—å –∏ –±—ã—Ç—å —á–∞—Å—Ç—å—é –±–æ–ª—å—à–æ–≥–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤. –ú—ã –≤–µ—Ä–∏–º, —á—Ç–æ –ª—é–±–æ–≤—å, —É–≤–∞–∂–µ–Ω–∏–µ –∏ –≤–µ—Ä–Ω–æ—Å—Ç—å ‚Äî —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ —Å—á–∞—Å—Ç–ª–∏–≤–æ–π –∂–∏–∑–Ω–∏. 

–ù–∞—à–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚Äî —ç—Ç–æ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç–æ–ª—å–Ω—ã–µ –∏–≥—Ä—ã, –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã, –æ—Ñ—Ñ–ª–∞–π–Ω-–∫–ª—É–±—ã –∑–Ω–∞–∫–æ–º—Å—Ç–≤, —Ñ–µ—Å—Ç–∏–≤–∞–ª–∏ –∏ –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å, –¥–µ–ª—è—Å—å –Ω–∞—à–∏–º–∏ —Ü–µ–Ω–Ω–æ—Å—Ç—è–º–∏. –£–∑–Ω–∞–π—Ç–µ –±–æ–ª—å—à–µ –æ —Ç–æ–º, –∫–∞–∫ –º—ã –ø–æ–º–æ–≥–∞–µ–º –ª—é–¥—è–º –Ω–∞—Ö–æ–¥–∏—Ç—å –≥–∞—Ä–º–æ–Ω–∏—é –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ!

–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –¥–≤–∏–∂–µ–Ω–∏—é, –∫–æ—Ç–æ—Ä–æ–µ –º–µ–Ω—è–µ—Ç –∂–∏–∑–Ω–∏ –∫ –ª—É—á—à–µ–º—É!
    """)
            f = open('assets/–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ.pdf', 'rb')
            bot.send_document(call.from_user.id, f)
        elif call.data == 'media_channels':
            markup = types.InlineKeyboardMarkup()
            button = types.InlineKeyboardButton("Telegram –∫–∞–Ω–∞–ª", url="https://t.me/za_lyubov_igra")
            button2 = types.InlineKeyboardButton("Rutube", url="https://rutube.ru/channel/25861872")
            markup.add(button, button2, row_width=1)
            bot.send_message(call.from_user.id, """        
–ë—É–¥—å—Ç–µ –≤ –∫—É—Ä—Å–µ –≤—Å–µ—Ö –Ω–æ–≤–æ—Å—Ç–µ–π –∏ —Å–æ–±—ã—Ç–∏–π –ø—Ä–æ–µ–∫—Ç–∞ '–ó–∞ –ª—é–±–æ–≤—å'! 

–ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞ –Ω–∞—à–∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏, —á—Ç–æ–±—ã —Å–ª–µ–¥–∏—Ç—å –∑–∞ –∞–Ω–æ–Ω—Å–∞–º–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π, –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–º–∏ –∏—Å—Ç–æ—Ä–∏—è–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ –ø–æ–ª–µ–∑–Ω—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏. 
–ú—ã –¥–µ–ª–∏–º—Å—è –≤–∏–¥–µ–æ, —Å—Ç–∞—Ç—å—è–º–∏ –∏ –æ—Ç–∑—ã–≤–∞–º–∏, —á—Ç–æ–±—ã –≤—ã —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏ —Å–µ–±—è —á–∞—Å—Ç—å—é –Ω–∞—à–µ–≥–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞!
    """, reply_markup=markup)
        
        # –ì–û–†–û–î–ê
        elif call.data == "sign_for_game":
            markup = types.InlineKeyboardMarkup()
            button1 = types.InlineKeyboardButton("–û–± –∏–≥—Ä–µ",callback_data="about_game")
            button2 = types.InlineKeyboardButton("–ù–∞—à–∏ –≥–æ—Ä–æ–¥–∞",callback_data="our_cities") 
            markup.add(button1, button2, row_width=1)
            bot.send_message(call.from_user.id, "–ù–∞—Å—Ç–æ–ª—å–Ω–∞—è –∏–≥—Ä–∞ '–ó–∞ –ª—é–±–æ–≤—å' ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–µ, –∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –Ω–æ–≤—ã–º–∏ –ª—é–¥—å–º–∏, —É–∫—Ä–µ–ø–∏—Ç—å —Å–≤—è–∑–∏ –∏ –æ–±—Å—É–¥–∏—Ç—å –≤–∞–∂–Ω—ã–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Ç–µ–º—ã –≤ –ª–µ–≥–∫–æ–π –∏ –Ω–µ–ø—Ä–∏–Ω—É–∂–¥–µ–Ω–Ω–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ.\n\n–ò–≥—Ä–∞ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤—Å–µ—Ö ‚Äî –æ—Ç –¥—Ä—É–∑–µ–π –¥–æ —Å–µ–º–µ–π–Ω—ã—Ö –ø–∞—Ä. –ó–∞–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ –±–ª–∏–∂–∞–π—à–µ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –≤ –≤–∞—à–µ–º –≥–æ—Ä–æ–¥–µ –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –º–∏—Ä –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è!", reply_markup=markup)
        elif call.data == "about_game":
            bot.send_message(call.from_user.id, """
–ò–≥—Ä–∞ '–ó–∞ –ª—é–±–æ–≤—å' —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è 1‚Äì12 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ª—é–¥–µ–π –ª—é–±–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç—è—Ç –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å —Å–µ–±—è –∏ –¥—Ä—É–≥–∏—Ö. 

–í –∫–æ–º–ø–ª–µ–∫—Ç –≤—Ö–æ–¥—è—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –≥–ª—É–±–æ–∫–∏–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏, –∑–∞–¥–∞–Ω–∏—è–º–∏ –∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥–∞—é—Ç —Ä–∞—Å–∫—Ä—ã—Ç—å—Å—è, –æ–±—Å—É–¥–∏—Ç—å —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –≤—ã—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–≤–µ—Ä–∏–µ. 
–≠—Ç–æ –∏–¥–µ–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –Ω–∞—á–∞—Ç—å —Å–≤–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ —ç–∫–æ—Å–∏—Å—Ç–µ–º–µ '–ó–∞ –ª—é–±–æ–≤—å'. –£–∑–Ω–∞–π—Ç–µ, –∫–∞–∫ –∏–≥—Ä–∞ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –≤–∞—à –≤–∑–≥–ª—è–¥ –Ω–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏—è!""")
        elif call.data == "our_cities":
            cities = session.execute(select(City)).scalars().all()
            markup = types.InlineKeyboardMarkup()
            for city in cities:
                button = types.InlineKeyboardButton(city.name, callback_data=f"city_{city.id}")
                markup.add(button)
            bot.send_message(call.from_user.id, "–ú—ã —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ–º –≤ 12 –≥–æ—Ä–æ–¥–∞—Ö –†–æ—Å—Å–∏–∏, –∏ –Ω–∞—à–∞ —Å–µ—Ç—å —Ä–∞—Å—Ç–µ—Ç!\n\n–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –≥–æ—Ä–æ–¥, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –æ –±–ª–∏–∂–∞–π—à–∏—Ö –∏–≥—Ä–∞—Ö, –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–º –∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –º–µ—Å—Ç–Ω–æ–º—É —Å–æ–æ–±—â–µ—Å—Ç–≤—É '–ó–∞ –ª—é–±–æ–≤—å'", reply_markup=markup)
        elif call.data.startswith("city_"):
            city_id = int(call.data.split("_")[1])
            city = session.execute(select(City).where(City.id == city_id)).scalar()
            markup = types.InlineKeyboardMarkup()
            button = types.InlineKeyboardButton("–°—Å—ã–ª–∫–∞ –Ω–∞ Telegram –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—è", url=city.agent_account)
            button2 = types.InlineKeyboardButton("–°—Å—ã–ª–∫–∞ –Ω–∞ Telegram-–∫–∞–Ω–∞–ª", url=city.channel_link)
            markup.add(button,button2, row_width=1)
            bot.send_message(call.from_user.id, f"""
–í –≥–æ—Ä–æ–¥–µ {city.name} –∏–≥—Ä—ã '–ó–∞ –ª—é–±–æ–≤—å' –ø—Ä–æ–≤–æ–¥–∏—Ç –Ω–∞—à –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π —Å —Ä–∞–¥–æ—Å—Ç—å—é –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –ø–æ–≥—Ä—É–∑–∏—Ç—å—Å—è –≤ –º–∏—Ä –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π. –°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∏–º –∏–ª–∏ –ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ Telegram-–∫–∞–Ω–∞–ª –≥–æ—Ä–æ–¥–∞ {city.name}, —á—Ç–æ–±—ã –±—ã—Ç—å –≤ –∫—É—Ä—Å–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π!

–î–ª—è –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –æ—Å–Ω–æ–≤–∞—Ç–µ–ª—é –ø—Ä–æ–µ–∫—Ç–∞: @RodionRa
                             """)
        
        # –ü–û–î–ü–ò–°–ö–ê
        elif call.data == "subscribe":
            markup = types.InlineKeyboardMarkup()
            button = types.InlineKeyboardButton("–ù–∞ –º–µ—Å—è—Ü –∑–∞ 333 ‚ÇΩ", callback_data=f"buy-subscribe_1_333")
            button2 = types.InlineKeyboardButton("–ù–∞ –≥–æ–¥ –∑–∞ 3333 ‚ÇΩ", callback_data=f"buy-subscribe_12_3333")
            markup.add(button,button2, row_width=1)
            bot.send_message(call.from_user.id, """
–ü–æ–¥–ø–∏—Å–∫–∞ '–ó–∞ –ª—é–±–æ–≤—å' ‚Äî —ç—Ç–æ –≤–∞—à –∫–ª—é—á –∫ –ø–æ–ª–Ω–æ–π —ç–∫–æ—Å–∏—Å—Ç–µ–º–µ –ø—Ä–æ–µ–∫—Ç–∞! –ó–∞ 333 —Ä—É–±./–º–µ—Å. (–ø–µ—Ä–≤—ã–π –º–µ—Å—è—Ü –±–µ—Å–ø–ª–∞—Ç–Ω–æ) –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–º –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º –∫—É—Ä—Å–∞–º –ø–æ –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏–π, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–º—É –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É –∏ –ª–∏—á–Ω–æ—Å—Ç–Ω–æ–º—É —Ä–æ—Å—Ç—É, –∞ —Ç–∞–∫–∂–µ –∫ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—É, –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ –∏ –∑–∞–∫—Ä—ã—Ç—ã–º –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è–º. 

–≠—Ç–æ –≤–∞—à —à–∞–Ω—Å —É—á–∏—Ç—å—Å—è, –æ–±—â–∞—Ç—å—Å—è –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ. –¢–∞–∫–∂–µ –≤—ã —Å–º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ.

–û—Ñ–æ—Ä–º–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –∏ –Ω–∞—á–Ω–∏—Ç–µ —Å–≤–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –∫ –≥–∞—Ä–º–æ–Ω–∏–∏""", reply_markup=markup)
        elif call.data.startswith("buy-subscribe"):
            # —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
            pay_link = 'https://example.com'
            months = call.data.split("_")[1]
            price = call.data.split("_")[2]
            
            pay_metadata = PayMetadata(
            user_id = user.id, 
                price = price,
                product = f"subscribe-{months}",
                procent_balance = 50,
                inner_balance = 0
            )
            
            session.add(pay_metadata)
            session.commit()
            
            idempotence_key = str(uuid.uuid4())
            
            payment = Payment.create(
                {
                    "id": idempotence_key,
                    "amount": {
                        "value": price,
                        "currency": "RUB"
                    },
                    "confirmation": {
                        "type": "redirect",
                        "return_url": "https://t.me/forlove2025_bot"
                    },
                    "capture": True,
                    "description": pay_metadata.id,
                    "metadata": {
                        'orderNumber': pay_metadata.id
                    },
                    "receipt": {
                        "customer": {
                            "full_name": "–ù–∏–∫–æ–ª–∞–µ–≤ –ê—Ä—Ç–µ–º –ê–ª–µ–∫—Å–µ–µ–≤–∏—á",
                            "email": "cfznyjdf13@mail.ru",
                            "phone": "79166758299",
                            "inn": "170108382176"
                        },
                        "items": [
                            {
                                "description": "–ü–æ–¥–ø–∏—Å–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã",
                                "quantity": "1.00",
                                "amount": {
                                    "value": price,
                                    "currency": "RUB"
                                },
                                "vat_code": "2",
                                "payment_mode": "full_payment",
                                "payment_subject": "commodity",
                                "country_of_origin_code": "RU",
                                "product_code": "44 4D 01 00 21 FA 41 00 23 05 41 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 12 00 AB 00",
                                "customs_declaration_number": "10714040/140917/0090376",
                                "excise": "20.00",
                                "supplier": {
                                    "name": "string",
                                    "phone": "string",
                                    "inn": "string"
                                }
                            },
                        ]
                    },
                }, 
                idempotency_key=idempotence_key
            )
            

            # get confirmation url
            confirmation_url = payment.confirmation.confirmation_url
            
            markup = types.InlineKeyboardMarkup()
            button = types.InlineKeyboardButton(f"–û–ø–ª–∞—Ç–∏—Ç—å ({price} ‚ÇΩ)", url=confirmation_url)
            #button2 = types.InlineKeyboardButton(f"–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É", callback_data=f"check-buy-subscribe_{pay_metadata.id}")
            markup.add(button, row_width=1)
            
            
            bot.send_message(call.from_user.id, f"""
–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã   
                             """, reply_markup=markup)
        elif call.data == "_subscribe-send_forlove":
            bot.send_message(call.from_user.id, "–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ –Ω–∞–ø–∏—à–∏—Ç–µ: @RodionRa")
        #–ü–†–û–î–£–ö–¢–´
        elif call.data == "our_products":
            markup = types.InlineKeyboardMarkup()
            button = types.InlineKeyboardButton("–í–µ–¥—É—â–∏–π –∏–≥—Ä—ã –∑–∞ 55555 ‚ÇΩ", callback_data=f"buy-product_game_55555")
            
            #button = types.InlineKeyboardButton("–í–ª–∞–¥–µ–ª–µ—Ü —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –∑–∞ 15 555 ‚ÇΩ", callback_data=f"buy-product_game_55555")
            #button = types.InlineKeyboardButton("–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–æ–º –∑–∞ 15 555 ‚ÇΩ", callback_data=f"buy-product_game_55555")
            #button = types.InlineKeyboardButton("–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä —Ç—É—Ä–æ–≤ –∑–∞ 15 555 ‚ÇΩ", callback_data=f"buy-product_game_55555")
            #button = types.InlineKeyboardButton("–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å/–ø–æ—Å—Ç–∞–≤—â–∏–∫ –∑–∞ 15 555 ‚ÇΩ", callback_data=f"buy-product_game_55555")
            
            button2 = types.InlineKeyboardButton("–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –ö–ª—É–±–∞ –∑–Ω–∞–∫–æ–º—Å—Ç–≤ –∑–∞ 79999 ‚ÇΩ", callback_data=f"buy-product_clubtraining_79999")
            
            markup.add(button,button2, row_width=1)
            
            if user.ref_level == 1: 
                button3 = types.InlineKeyboardButton("–ü–∞–∫–µ—Ç –∑–∞ 5000 ‚ÇΩ", callback_data=f"buy-product_package_5000")
                markup.add(button3)
            if user.ref_level == 2: 
                button4 = types.InlineKeyboardButton("–ü–∞–∫–µ—Ç –∑–∞ 15000 ‚ÇΩ", callback_data=f"buy-product_package_15000")
                markup.add(button4)
            if user.ref_level == 3:
                button5 = types.InlineKeyboardButton("–ü–∞–∫–µ—Ç –∑–∞ 25000 ‚ÇΩ", callback_data=f"buy-product_package_25000")
                markup.add(button5)
            if user.ref_level == 4:
                button6 = types.InlineKeyboardButton("–ü–∞–∫–µ—Ç –∑–∞ 45000 ‚ÇΩ", callback_data=f"buy-product_package_45000")
                markup.add(button6)
            if user.ref_level == 5: 
                button7 = types.InlineKeyboardButton("–ü–∞–∫–µ—Ç –∑–∞ 100000 ‚ÇΩ", callback_data=f"buy-product_package_100000")
                markup.add(button7)

            
            bot.send_message(call.from_user.id, """
–•–æ—Ç–∏—Ç–µ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å, –¥–µ–ª—è—Å—å —Ü–µ–Ω–Ω–æ—Å—Ç—è–º–∏ '–ó–∞ –ª—é–±–æ–≤—å'?
–ù–∞—à–∞ –±–∏–∑–Ω–µ—Å-–º–æ–¥–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π: –æ—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∏–≥—Ä –¥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–æ—Ä–æ–¥–æ–º –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞. 

–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –≤–∞–º –±–ª–∏–∂–µ, –∏ –Ω–∞—á–Ω–∏—Ç–µ —Å–≤–æ–π –ø—É—Ç—å –∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π —Å–≤–æ–±–æ–¥–µ –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—é. –ú—ã –ø–æ–¥–¥–µ—Ä–∂–∏–º –≤–∞—Å –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥—É: –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–º –æ–±—É—á–µ–Ω–∏–µ, –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –¥–æ—Å—Ç—É–ø –∫ –Ω–∞—à–µ–π —ç–∫–æ—Å–∏—Å—Ç–µ–º–µ!    
""",reply_markup=markup)
        elif call.data.startswith("buy-product"):
            name = call.data.split("_")[1]
            price = call.data.split("_")[2]
            pay_link = 'https://example.com'
            
            pay_metadata = PayMetadata(
                user_id = user.id,
                price = price,
                product = name,
                procent_balance = 25,
                inner_balance = 25
            )
            
            session.add(pay_metadata)
            session.commit()
            
            idempotence_key = str(uuid.uuid4())
            
            payment = Payment.create(
                {
                    "id": idempotence_key,
                    "amount": {
                        "value": price,
                        "currency": "RUB"
                    },
                    "confirmation": {
                        "type": "redirect",
                        "return_url": "https://t.me/forlove2025_bot"
                    },
                    "capture": True,
                    "description": pay_metadata.id,
                    "metadata": {
                        'orderNumber': pay_metadata.id
                    },
                    "receipt": {
                        "customer": {
                            "full_name": "–ù–∏–∫–æ–ª–∞–µ–≤ –ê—Ä—Ç–µ–º –ê–ª–µ–∫—Å–µ–µ–≤–∏—á",
                            "email": "cfznyjdf13@mail.ru",
                            "phone": "79166758299",
                            "inn": "170108382176"
                        },
                        "items": [
                            {
                                "description": "–ü–∞–∫–µ—Ç",
                                "quantity": "1.00",
                                "amount": {
                                    "value": price,
                                    "currency": "RUB"
                                },
                                "vat_code": "2",
                                "payment_mode": "full_payment",
                                "payment_subject": "commodity",
                                "country_of_origin_code": "RU",
                                "product_code": "44 4D 01 00 21 FA 41 00 23 05 41 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 12 00 AB 00",
                                "customs_declaration_number": "10714040/140917/0090376",
                                "excise": "20.00",
                                "supplier": {
                                    "name": "string",
                                    "phone": "string",
                                    "inn": "string"
                                }
                            },
                        ]
                    },
                }, 
                idempotency_key=idempotence_key
            )
            
            confirmation_url = payment.confirmation.confirmation_url
            
            markup = types.InlineKeyboardMarkup()    
            button = types.InlineKeyboardButton(f"–û–ø–ª–∞—Ç–∏—Ç—å ({price} ‚ÇΩ)", url=confirmation_url)
            #button2 = types.InlineKeyboardButton(f"–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É", callback_data=f"check-buy-product_{pay_metadata.id}")
            markup.add(button, row_width=1)
            
            
            
            text = ""
            if name == "game":
                image_url = "https://iimg.su/s/17/WjbY8Fs5oXFRxx3LDZV9yUSzQjtvA2BCBQWwMad1.png"
                text = """
–ö–û–ú–ü–õ–ï–ö–¢ –í–ï–î–£–©–ï–ì–û –ò–ì–†

–ú—ã –ø—Ä–∏—Å—ã–ª–∞–µ–º –≤–∞–º –∫–æ–º–ø–ª–µ–∫—Ç –Ω–∞—Å—Ç–æ–ª—å–Ω–æ–π –∏–≥—Ä—ã, —Å –Ω–∏–º –≤—ã —Å–º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –∏–≥—Ä—ã –≤ —Å–≤–æ–µ–º –≥–æ—Ä–æ–¥–µ –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ —ç—Ç–æ–º. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –±–∞–∑–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ —Ç–∞–∫–∂–µ –ø—Ä–∏–ª–∞–≥–∞–µ—Ç—Å—è.
–í—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å –¥–æ—Ö–æ–¥ –æ—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∏–≥—Ä –∏ –±–æ–Ω—É—Å—ã –ø–æ –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ.
–°—Ç–æ–∏–º–æ—Å—Ç—å: 55.555 —Ä—É–±.
–ü—Ä–æ–≥–Ω–∞–∑–∏—Ä—É–µ–º–∞—è –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å: 1-2 –º–µ—Å—è—Ü–∞.
                """
            elif name == "clubtraining":
                image_url = "https://iimg.su/s/17/tAG14iNFiiiGpLTVv4o9Ip07onLPoN3IQ6wMrinK.png"
                text = """
–û–ë–£–ß–ê–Æ–©–ò–ô –ö–£–†–° "–†–£–ö–û–í–û–î–ò–¢–ï–õ–¨ –ì–û–†–û–î–°–ö–û–ì–û –ö–õ–£–ë–ê –ó–ù–ê–ö–û–ú–°–¢–í"

–ú—ã –ø—Ä–∏—Å—ã–ª–∞–µ–º –≤–∞–º –∫–æ–º–ø–ª–µ–∫—Ç –Ω–∞—Å—Ç–æ–ª—å–Ω–æ–π –∏–≥—Ä—ã, —Å –Ω–∏–º –≤—ã —Å–º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –∏–≥—Ä—ã –≤ —Å–≤–æ–µ–º –≥–æ—Ä–æ–¥–µ –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ —ç—Ç–æ–º. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –±–∞–∑–æ–≤–æ–µ –æ–±—É—á–µ–Ω–∏–µ –ø—Ä–∏–ª–∞–≥–∞–µ—Ç—Å—è.
–¢–∞–∫–∂–µ –≤—ã —Å–º–æ–∂–µ—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, —Ç—É—Ä—ã, —Ñ–µ—Å—Ç–∏–≤–∞–ª–∏ –æ—Ç –Ω–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏.
–í—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å –¥–æ—Ö–æ–¥ –æ—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∏–≥—Ä –∏ –¥—Ä—É–≥–∏—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π, –∏ –±–æ–Ω—É—Å—ã –ø–æ –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ.
–°—Ç–æ–∏–º–æ—Å—Ç—å: 79.999 —Ä—É–±.
–ü—Ä–æ–≥–Ω–∞–∑–∏—Ä—É–µ–º–∞—è –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å: 1-2 –º–µ—Å—è—Ü–∞.                
"""
            elif name == "package":
                text = """
–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—à–∏—Ä–∏—Ç—å –∑–∞—Ä–∞–±–æ—Ç–æ–∫ —Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã
"""
                image_url = None
            if image_url:
                bot.send_photo(call.from_user.id, image_url, text, reply_markup=markup)
            else:
                bot.send_message(call.from_user.id, text, reply_markup=markup)
        elif call.data == "_buy-product_forlove":
            bot.send_message(call.from_user.id, "–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ –Ω–∞–ø–∏—à–∏—Ç–µ: @RodionRa")
          
        #–ú–ï–†–û–ü–†–ò–Ø–¢–ò–Ø
        elif call.data == "our_events":
            markup = types.InlineKeyboardMarkup()    
            button = types.InlineKeyboardButton("–§–æ—Ä–º–∞—Ç—ã –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π", callback_data="event_formats")
            button2 = types.InlineKeyboardButton("–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ", callback_data="event_table")
            button3 = types.InlineKeyboardButton("–°—Ç–∞—Ç—å –≥–∏–¥–æ–º", callback_data="become_guide")
            markup.add(button, button2, button3, row_width=1)
            
            bot.send_message(call.from_user.id, """
–ü—Ä–æ–µ–∫—Ç '–ó–∞ –ª—é–±–æ–≤—å' ‚Äî —ç—Ç–æ –Ω–µ —Ç–æ–ª—å–∫–æ –∏–≥—Ä—ã, –Ω–æ –∏ —è—Ä–∫–∏–µ –æ—Ñ—Ñ–ª–∞–π–Ω-–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è: —Ñ–µ—Å—Ç–∏–≤–∞–ª–∏ –∑–Ω–∞–∫–æ–º—Å—Ç–≤, —Ç—É—Ä—ã, –∫–æ–Ω–∫—É—Ä—Å—ã –∫—Ä–∞—Å–æ—Ç—ã –∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∏–µ –≤—Å—Ç—Ä–µ—á–∏. 

–ö–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ —Å–æ–∑–¥–∞–Ω–æ, —á—Ç–æ–±—ã –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –ª—é–¥–µ–π, –ø–æ–º–æ–≥–∞—Ç—å –Ω–∞—Ö–æ–¥–∏—Ç—å –¥—Ä—É–∑–µ–π, –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –∏–ª–∏ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤. 
–£–∑–Ω–∞–π—Ç–µ –±–æ–ª—å—à–µ –æ –Ω–∞—à–∏—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö, –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∏–ª–∏ —Å—Ç–∞–Ω—å—Ç–µ –≥–∏–¥–æ–º, —á—Ç–æ–±—ã –æ—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –≤ —Å–≤–æ–µ–º –≥–æ—Ä–æ–¥–µ!
                             """, reply_markup=markup)
        
        elif call.data == "event_formats":
            markup = types.InlineKeyboardMarkup()    
            button = types.InlineKeyboardButton("–¢—É—Ä—ã", callback_data="event_tours")
            button2 = types.InlineKeyboardButton("–§–µ—Å—Ç–∏–≤–∞–ª–∏", callback_data="event_forlove")
            button3 = types.InlineKeyboardButton("–ö–æ–Ω–∫—É—Ä—Å—ã –∫—Ä–∞—Å–æ—Ç—ã", callback_data="event_forlove")
            button4 = types.InlineKeyboardButton("–†–µ—Ç—Ä–∏—Ç—ã", callback_data="event_forlove")
            button5 = types.InlineKeyboardButton("–†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏", callback_data="event_forlove")
            markup.add(button, button2, button3, button4, button5, row_width=2)
            
            bot.send_message(call.from_user.id, """
–ú—ã –ø—Ä–æ–≤–æ–¥–∏–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π, —á—Ç–æ–±—ã –∫–∞–∂–¥—ã–π –Ω–∞—à–µ–ª —á—Ç–æ-—Ç–æ –¥–ª—è —Å–µ–±—è. 
–í—ã–±–µ—Ä–∏—Ç–µ, —á—Ç–æ –≤–∞—Å –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç: —Ñ–µ—Å—Ç–∏–≤–∞–ª–∏, —Ç—É—Ä—ã, –∫–æ–Ω–∫—É—Ä—Å—ã –∏–ª–∏ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã.
–î–ª—è –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–∞–ø–∏—à–∏—Ç–µ: @RodionRa
                             """, reply_markup=markup)
        elif call.data == "event_tours":
            f = open('assets/video_tour.mp4', 'rb')
            bot.send_video(call.from_user.id, f, timeout=60)
            bot.send_message(call.from_user.id, """
–§–µ—Å—Ç–∏–≤–∞–ª—å –∑–Ω–∞–∫–æ–º—Å—Ç–≤ –Ω–∞ –æ–∑.

   –¢–£–†–ì–û–Ø–ö

    22-24
   –ê–í–ì–£–°–¢–ê

–û—Ç–ø—Ä–∞–≤–ª—è–µ–º—Å—è –≤ —Å–∫–∞–∑–æ—á–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –ø–æ –º–µ—Å—Ç–∞–º —Å–∏–ª—ã –Æ–∂–Ω–æ–≥–æ –£—Ä–∞–ª–∞ –Ω–∞ –æ–∑ –¢—É—Ä–≥–æ—è–∫¬†, —Å –ø–æ—Å–µ—â–µ–Ω–∏–µ–º –æ. –í–µ—Ä—ã¬†¬†

1–π –¥–µ–Ω—å¬† 
üíõ07-00 –í—ã–µ–∑–¥ –Ω–∞ –º–∏–Ω–∏–≤–µ–Ω–∞—Ö –∏–∑ –≥. –û–∫—Ç—è–±—Ä—å—Å–∫–∏–π ( –≤—Ö–æ–¥–∏—Ç)
üíõ09-30 –í—ã–µ–∑–¥ –∏–∑ –≥. –£—Ñ–∞ ( –≤—Ö–æ–¥–∏—Ç )
üíõ12-30 –û–±–µ–¥ –≤ –∫–∞—Ñ–µ 
(—Å–∞–º-–Ω–æ)
üíõ14-00 –ü—Ä–æ–≥—É–ª–∫–∞ –ø–æ –ø–∞—Ä–∫—É –ë–∞–∂–æ–≤–∞ –ü.–ü. –≤ –≥. –ó–ª–∞—Ç–æ—É—Å—Ç.( –≤—Ö–æ–¥–∏—Ç)
üíõ16-00¬† –ó–∞—Å–µ–ª–µ–Ω–∏–µ –≤ –¥–æ–º —Å–æ –≤—Å–µ–º–∏ —É–¥–æ–±—Å—Ç–≤–∞–º–∏ –∏–ª–∏ –≤ –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã¬† .( –≤—Ö–æ–¥–∏—Ç)
üíõ17-00¬† –≠–∫—Å–∫—É—Ä—Å–∏—è –ø–æ –æ–∑. –¢—É—Ä–≥–æ—è–∫, ( –ë—Ä–∞—Ç–∏—à–∫–∞ –ë–∞–π–∫–∞–ª–∞ - –ñ–µ–º—á—É–∂–∏–Ω–∞ –£—Ä–∞–ª–∞), —Å–º–æ—Ç—Ä–æ–≤—ã–µ –ø–ª–æ—â–∞–¥–∫–∏, –ó–æ–ª–æ—Ç–æ–π –ø–ª—è–∂, –æ–∑. –ò–Ω—ã—à–∫–æ, —Ç—Ä–æ–ø–∞ –ü—É–≥–∞—á–µ–≤–∞ . ( –≤—Ö–æ–¥–∏—Ç )
üíõ19-30 –£–∂–∏–Ω.( –≤—Ö–æ–¥–∏—Ç )
- –ó–Ω–∞–∫–æ–º—Å—Ç–≤–∞ .
-¬†–ò–≥—Ä–∞ –ó–∞ –ª—é–±–æ–≤—å

2-–æ–π –¥–µ–Ω—å 
‚òÄÔ∏è08-30 –π–æ–≥–∞ ( –≤—Ö–æ–¥–∏—Ç )
‚òÄÔ∏è09-00 –ó–∞–≤—Ç—Ä–∞–∫ (–≤—Ö–æ–¥–∏—Ç )
‚òÄÔ∏è10-00 —ç–∫—Å–∫—É—Ä—Å–∏—è –Ω–∞ –∫–æ—Ä–∞–±–ª–µ –ø–æ –û–∑¬† –¢—É—Ä–≥–æ—è–∫ –Ω–∞ –æ—Å—Ç—Ä–æ–≤ –í–µ—Ä—ã ! ( –ú–µ—Å—Ç–æ —Å–∏–ª—ã –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∂–µ–ª–∞–Ω–∏–π ) ( –í—Ö–æ–¥–∏—Ç )
‚òÄÔ∏è14-00 –û–±–µ–¥ ( –≤—Ö–æ–¥–∏—Ç )
‚òÄÔ∏è–≠–∫—Å–∫—É—Ä—Å–∏–∏¬† –ø–æ –¥—Ä—É–≥–∏–º –ª–æ–∫–∞—Ü–∏—è–º –æ–∑. –¢—É—Ä–≥–æ—è–∫ . ( –≤—Ö–æ–¥–∏—Ç )
‚òÄÔ∏è19-00 –£–∂–∏–Ω ( –≤—Ö–æ–¥–∏—Ç )
‚òÄÔ∏è20-00¬† –†—É—Å—Å–∫–∞—è –ë–∞–Ω—è¬† ( –≤—Ö–æ–¥–∏—Ç )
–°–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è - –∫—É–ø–∞–µ–º—Å—è –≤ —á–∏—Å—Ç–µ–π—à–µ–º –æ–∑–µ—Ä–µ üåä

3–∏–π –¥–µ–Ω—å 
‚ú®08-30 –π–æ–≥–∞
‚ú®09-00 –ó–∞–≤—Ç—Ä–∞–∫ ( –≤—Ö–æ–¥–∏—Ç )
‚ú®10-00 –≠–∫—Å–∫—É—Ä—Å–∏—è –≤ –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∫ –¢–∞–≥–∞–Ω–∞–π, –≥–¥–µ –ø–æ —Ç–∞–π–≥–µ –ø—Ä–æ–π–¥–µ–º –∫ –¥–≤—É–º —Å–º–æ—Ç—Ä–æ–≤—ã–º –ø–ª–æ—â–∞–¥–∫–∞–º , –æ—Ç–∫—É–¥–∞ –±—É–¥–µ–º –ª—é–±–æ–≤–∞—Ç—å—Å—è –£—Ä–∞–ª—å—Å–∫–∏–º–∏ –≥–æ—Ä–∞–º–∏ –∏ –ø—Ä–æ—Å—Ç–æ—Ä–∞–º–∏ –£—Ä–∞–ª–∞ . ( –≤—Ö–æ–¥–∏—Ç )
‚ú®–ü–æ—Å–µ—â–µ–Ω–∏–µ —Ö—Ä–∞–º–∞ –°–µ—Ä–∞—Ñ–∏–º–∞ –°–∞—Ä–æ–≤—Å–∫–æ–≥–æ –≤ –≥. –ó–ª–∞—Ç–æ—É—Å—Ç .
‚ú®20-00 –ü—Ä–∏–±—ã—Ç–∏–µ –≤ –£—Ñ—É
‚ú®22-15 –ü—Ä–∏–±—ã—Ç–∏–µ –≤ –≥.–û–∫—Ç—è–±—Ä—å—Å–∫–∏–π.

P.S. –ü—Ä–æ–≥—Ä–∞–º–º–∞ –∏ –≤—Ä–µ–º—è –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è –ø–æ —É—Å–º–æ—Ç—Ä–µ–Ω–∏—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤ 

–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
üì± +7 916 675-82-99

–ó–∞–ø–∏—Å—å –∏–Ω—Ç–µ—Ä–≤—å—é —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º–∏
<a href="https://rutube.ru/video/292dd3a0d2a35a40b482d7d04f61ad69/?r=a/">–ü–æ –≠–¢–û–ô –°–°–´–õ–ö–ï</a>

–ë–†–û–ù–¨ –∑–∞—Ä–∞–Ω–µ–µ, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ

–°–¢–û–ò–ú–û–°–¢–¨

ü™Ñ 25 000‚ÇΩ / —á–µ–ª.
ü™Ñ 48 000‚ÇΩ / –Ω–∞ –¥–≤–æ–∏—Ö

–ë–æ–Ω—É—Å –∑–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é
üíõ2 500‚ÇΩ

–≠–¢–û –î–õ–Ø –¢–ï–ë–Ø
ü§çü§çü§çü§çü§çü§çü§çü§çü§ç
–µ—Å–ª–∏¬† —Ç–µ–±–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ¬† –æ–±–Ω—É–ª–∏—Ç—å—Å—è, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è , —É–∑–Ω–∞—Ç—å —Å–µ–±—è –∏ –Ω–∞–ø–æ–ª–Ω–∏—Ç—å—Å—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–µ–π , –∞ —Ç–∞–∫ –∂–µ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è –∏ –ø–æ–¥—Ä—É–∂–∏—Ç—å—Å—è —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ —Ñ–µ—Å—Ç–∏–≤–∞–ª—è , –∏ –≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —è—á–µ–π–∫—É –æ–±—â–µ—Å—Ç–≤–∞ü§ç

       üçí –í–∏—à–µ–Ω–∫–∞ –Ω–∞ —Ç–æ—Ä—Ç–µ üçí

–ó–Ω–∞–µ—Ç–µ –∫–ª–∏–ø, –∫–æ—Ç–æ—Ä—ã–π –æ–±–æ—à–µ–ª –≤ –º–∏—Ä–æ–≤—ã—Ö —á–∞—Ä—Ç–∞—Ö –õ–µ–¥–∏ –ì–ê–ì–ê. 
–ù–∞—à–∏ –ë–∞—à–∫–∏—Ä—Å–∫–∏–µ —Ä–µ–±—è—Ç–∞ –≤–∑–æ—Ä–≤–∞–ª–∏ –≤–µ—Å—å –º–∏—Ä –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ –º–æ—Ç–∏–≤–∞–º–∏! 
–ú—ã –Ω–µ–ø—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–±—ã–≤–∞–µ–º –≤ —Ç–µ—Ö –Ω–∞–º–æ–ª–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö, –≥–¥–µ —Å–Ω–∏–º–∞–ª–∏ —ç—Ç–æ –Ω–µ–∑–∞–º—ã—Å–ª–æ–≤–∞—Ç–æ–µ –≤–∏–¥–µ–æ, –∑–∞–≤–æ–µ–≤–∞–≤—à–µ–µ –≤–µ—Å—å –º–∏—Ä
‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è
<a href="https://yandex.ru/video/touch/preview/2593925414043493009">–°–ª—É—à–∞—Ç—å –∏ —Å–º–æ—Ç—Ä–µ—Ç—å –∫–ª–∏–ø –ó–î–ï–°–¨</a>  
                             """, parse_mode='html')
            
            f = open('assets/video_tour2.mp4', 'rb')
            bot.send_video(call.from_user.id, f, timeout=60)
            bot.send_message(call.from_user.id, """
–ö–ê–õ–ò–ù–ò–ù–ì–†–ê–î
–†–æ–¥–∏–Ω–∞ –∞–≤—Ç–æ—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ 
–ó–∞‚ù§Ô∏è–õ—é–±–æ–≤—å –ê—Ä—Ç–µ–º–∞ –ù–∏–∫–æ–ª–∞–µ–≤–∞

–ì–æ—Å—Ç–µ–≤–æ–π –¥–æ–º –í–ò–®–¢–´–ù–ï–¶!

‚ô•Ô∏è22 –∞–≤–≥—É—Å—Ç–∞ –Ω–∞ –¥–≤–æ–µ —Å—É—Ç–æ–∫
(—Å –ø—è—Ç–Ω–∏—Ü—ã –ø–æ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)
–í—Å–µ–≥–æ 1 —Ä–∞–∑ –≤ —ç—Ç–æ–º –≥–æ–¥—É! 

–°–Ω–∏–º–∞–µ–º –≤–µ—Å—å –≥–æ—Å—Ç–µ–≤–æ–π –¥–æ–º! üî•
2 –æ—Å–æ–±–Ω—è–∫–∞!  –ù–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –Ω–µ –±—É–¥–µ—Ç —á—É–∂–∏—Ö –ª—é–¥–µ–π. 

üè†–û–≥—Ä–æ–º–Ω–∞—è –∑–µ–ª–µ–Ω–∞—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è —É –æ–∑–µ—Ä–∞. 
üë©–ù–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ 3 –±–µ—Å–µ–¥–∫–∏, –æ–¥–Ω–∞ –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –±–æ–ª—å—à–∞—è - –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ç–∞–Ω—Ü–µ–≤. 
üç¢–ë–æ–ª—å—à–æ–π –∫–∞–º–∏–Ω–Ω—ã–π –∑–∞–ª. –ö—É—Ö–Ω—è —Å –æ–±–µ–¥–µ–Ω–Ω–æ–π –∑–æ–Ω–æ–π –≤–Ω—É—Ç—Ä–∏ –∏ –Ω–∞ —É–ª–∏—Ü–µ –ø–æ–¥ –∫—Ä—ã—à–µ–π. 

6 2—Ö –∫–æ–º–Ω–∞—Ç–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ —Å —Ç–µ—Ä—Ä–∞—Å–∞–º–∏ (–¥–≤—É—Å–ø–∞–ª—å–Ω–∞—è –∫—Ä–æ–≤–∞—Ç—å, +–∫—Ä–æ–≤–∞—Ç—å), —Å–∞–Ω—É–∑–µ–ª, –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫—É—Ö–Ω—è.
üî• –°–≤–æ—è –±–æ–ª—å—à–∞—è –ª—É–∂–∞–π–∫–∞ —Å –º–∞–Ω–≥–∞–ª–∞–º–∏ –∏ –º–µ—Å—Ç–æ–º –¥–ª—è –æ—Ç–¥—ã—Ö–∞. 
10 –Ω–æ–º–µ—Ä–æ–≤ —Å —Å–∞–Ω—É–∑–ª–∞–º–∏ –æ—Ç 2—Ö –¥–æ 5 —á–µ–ª–æ–≤–µ–∫, –∏–∑ –Ω–∏—Ö —Ç–æ–ª—å–∫–æ 2 –Ω–æ–º–µ—Ä–∞ –¥–ª—è –ø–∞—Ä—ã (—Ç–æ–ª—å–∫–æ –¥–≤—É—Å–ø–∞–ª—å–Ω–∞—è –∫—Ä–æ–≤–∞—Ç—å). 
7 –Ω–æ–º–µ—Ä–æ–≤ –Ω–∞ –ú–∞–Ω—Å–∞—Ä–¥–µ (—ç–∫–æ–Ω–æ–º –≤–∞—Ä–∏–∞–Ω—Ç). –¢—É–∞–ª–µ—Ç –∏ –¥—É—à –Ω–∞ —ç—Ç–∞–∂–µ.


–ß—Ç–æ –Ω–∞—Å –∂–¥—ë—Ç:

‚òÄÔ∏è–ö—É–ø–∞–Ω–∏–µ –≤ –æ.–í–∏—à—Ç—ã–Ω–µ—Ü –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ —Å –ü–æ–ª—å—à–µ–π
‚òÄÔ∏è–ö–∞—Ç–∞–Ω–∏–µ –Ω–∞ –°–∞–ø–µ
‚òÄÔ∏è–¢–∞–Ω—Ü—ã –ë–∞—á–∞—Ç–∞ –∏ –°–∞–ª—å—Å–∞ –Ω–∞ —Å–≤–µ–∂–µ–º –≤–æ–∑–¥—É—Ö–µ 
‚òÄÔ∏è–ò–≥—Ä–∞ –ó–∞üíõ–õ—é–±–æ–≤—å –æ—Ç –æ—Å–Ω–æ–≤–∞—Ç–µ–ª–µ–π
‚òÄÔ∏è–ú–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã –ø–æ —Ç–∞–Ω—Ü–∞–º —Å –Ω—É–ª—è
‚òÄÔ∏è–®–∞—à–ª—ã–∫–∏, –∫–æ—Å—Ç–µ—Ä, –¥—É—à–µ–≤–Ω—ã–µ –ø–æ—Å–∏–¥–µ–ª–∫–∏
‚òÄÔ∏è–ù–æ–≤—ã–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞ —Å –ø–æ—Ç—Ä—è—Å–∞—é—â–∏–º–∏ –ª—é–¥—å–º–∏

üë©‚Äçüëß –ï—Å—Ç—å —Ç–µ, –∫—Ç–æ –µ–¥–µ—Ç —Å –¥–µ—Ç—å–º–∏! 
–ò–º –µ—Å—Ç—å, —á–µ–º –∑–∞–Ω—è—Ç—å—Å—è: –§—É—Ç–±–æ–ª—å–Ω–æ–µ –ø–æ–ª–µ. –ë–∞—Å–∫–µ—Ç–±–æ–ª. –í–æ–ª–µ–π–±–æ–ª. 2 –¥–µ—Ç—Å–∫–∏–µ –ø–ª–æ—â–∞–¥–∫–∏, –≥–æ—Ä–∫–∞ –≤ –æ–∑–µ—Ä–µ. 

–ó–∞–µ–∑–¥ –≤ –Ω–æ–º–µ—Ä–∞ –≤ –ø—è—Ç–Ω–∏—Ü—É —Å 14.00. (–ú–Ω–æ–≥–∏–µ –ø—Ä–∏–µ–∑–∂–∞—é—Ç –≤–µ—á–µ—Ä–æ–º –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã)
–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 12.00.
–ò –º–æ–∂–µ–º –µ—â–µ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏. –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ç–∞–Ω—Ü–µ–≤–∞—Ç—å, —Ä–∞–∑—É—á–∏–≤–∞—Ç—å –∏ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Ñ—É—Ç–≤–æ—Ä–∫–∏. –ì–æ—Ç–æ–≤–∏—Ç—å —à–∞—à–ª—ã–∫, –∫—É–ø–∞—Ç—å—Å—è, –≥—É–ª—è—Ç—å. 

–°–¢–û–ò–ú–û–°–¢–¨

17 500‚ÇΩ/ —Å —á–µ–ª–æ–≤–µ–∫–∞
‚ù§Ô∏è–î–ª—è –≤–µ–¥—É—â–∏—Ö –∏–≥—Ä—ã
12 500‚ÇΩ

–ë–æ–Ω—É—Å –∑–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é
üíõ 2 500‚ÇΩ
–î–ª—è –≤–µ–¥—É—â–∏—Ö –∏–≥—Ä—ã 
üíõ5 000‚ÇΩ

–í —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–æ–º–µ—Ä–æ–≤ –≤–∫–ª—é—á–µ–Ω–æ: 
üíõ–ü—Ä–æ–∂–∏–≤–∞–Ω–∏–µ –¥–≤–æ–µ —Å—É—Ç–æ–∫, 
üíõ–ú–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã –ø–æ –±–∞—á–∞—Ç–µ –∏ —Å–∞–ª—å—Å–µ, –æ—É–ø—ç–Ω —ç–π—Ä —Å–æ —Å–≤–µ—Ç–æ–º—É–∑—ã–∫–æ–π. 
üíõ–ü–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–∞–º–∏–Ω–Ω—ã–º –∑–∞–ª–æ–º –≤—Ç–æ—Ä–æ–≥–æ –¥–æ–º–∞. 
üíõ–ü–æ—Å—Ç–µ–ª—å–Ω–æ–µ –±–µ–ª—å–µ –∏ –ø–æ–ª–æ—Ç–µ–Ω—Ü–∞ –µ—Å—Ç—å –¥–ª—è –≤—Å–µ—Ö! 

üßë‚Äçüç≥ –° –Ω–∞–º–∏ –µ–¥–µ—Ç –ø–æ–≤–∞—Ä!!! 

–ë–†–û–ù–¨

–î–æ 26 –∏—é–ª—è - 5 000‚ÇΩ
–û—Å—Ç–∞–ª–æ—Å—å 6 –º–µ—Å—Ç

–û—Å—Ç–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å—ã?
–ü–∏—à–∏ üì± 8 916 675 82 99
                             """, parse_mode='html')
            
        elif call.data == "event_forlove":
            bot.send_message(call.from_user.id, """–î–ª—è –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–∞–ø–∏—à–∏—Ç–µ: @RodionRa""")
        elif call.data == "_event_festival":
            bot.send_message(call.from_user.id, """–ò–Ω—Ñ–∞ –ø—Ä–æ –§–µ—Å—Ç–∏–≤–∞–ª—å""")
        elif call.data == "_event_conferences":
            bot.send_message(call.from_user.id, """–ò–Ω—Ñ–∞ –ø—Ä–æ –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏""")
        
        elif call.data == "event_table":
            today = datetime.now().strftime("%d.%m")
            
            stmt = select(Schedule).where(Schedule.start >= today) # –ø–æ–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
            results = session.execute(stmt)
            schedules = results.scalars().all()
            markup = types.InlineKeyboardMarkup()    
            for schedule in schedules: 
                button = types.InlineKeyboardButton(f"{schedule.name}, {schedule.city}, {schedule.start}", callback_data=f"event_table_inner-{schedule.id}")
                markup.add(button, row_width=1)
            addiction_text = ""
            if len(schedules) == 0: addiction_text = "–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è —Å–∫–æ—Ä–æ"
            bot.send_message(call.from_user.id, f"""
–û–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –Ω–∞—à–∏—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–æ, —á—Ç–æ –≤–∞–º –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ! –û—Ç —Ñ–µ—Å—Ç–∏–≤–∞–ª–µ–π –¥–æ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á ‚Äî —É –Ω–∞—Å –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å —á—Ç–æ-—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ–µ.

{addiction_text}
                             """, reply_markup=markup)
        elif call.data.startswith("event_table_inner"):
            schedule_id = int(call.data.split("-")[1])
            schedule = session.execute(select(Schedule).where(Schedule.id == schedule_id)).scalar()
            
            pay_link = "https://example.com"
            
            markup = types.InlineKeyboardMarkup()
            button = types.InlineKeyboardButton("–ö—É–ø–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç", callback_data="inner_event_table_text")
            markup.add(button)
            
            bot.send_message(call.from_user.id, f"""
–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
{schedule.name}, {schedule.city}, {schedule.start}
""", reply_markup=markup)
        elif call.data == "inner_event_table_text":
            bot.send_message(call.from_user.id, f"–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ –∏ –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ @RodionRa")
        
        elif call.data == "become_guide":
            markup = types.InlineKeyboardMarkup()
            button = types.InlineKeyboardButton("–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É", callback_data="become_guide_stay")
            markup.add(button)
            bot.send_message(call.from_user.id, f"""
–ú–µ—á—Ç–∞–µ—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å —Ç—É—Ä—ã –∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è '–ó–∞ –ª—é–±–æ–≤—å' –≤ –≤–∞—à–µ–º –≥–æ—Ä–æ–¥–µ? 

–°—Ç–∞–Ω—å—Ç–µ –≥–∏–¥–æ–º –∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è–π—Ç–µ –ª—é–¥–µ–π –Ω–∞ –Ω–æ–≤—ã–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ! –ú—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–º –≤–∞–º –æ–±—É—á–µ–Ω–∏–µ, –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É, —á—Ç–æ–±—ã –≤—ã –º–æ–≥–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ–∑–∞–±—ã–≤–∞–µ–º—ã–µ —Å–æ–±—ã—Ç–∏—è. –£–∑–Ω–∞–π—Ç–µ, –∫–∞–∫ –Ω–∞—á–∞—Ç—å, –∏ –ø–æ–¥–∞–π—Ç–µ –∑–∞—è–≤–∫—É!
–î–ª—è –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–∞–ø–∏—à–∏—Ç–µ: @RodionRa
""", reply_markup=markup)
        
        elif call.data == "become_guide_stay":
            bot.send_message(call.from_user.id, f"–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞")
            bot.send_message(61886854, f"–ó–∞—è–≤–∫–∞ –æ—Ç @{user.username} –Ω–∞ '–ì–∏–¥–∞'")
        
        # –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê
        elif call.data == "ref_program":
            markup = types.InlineKeyboardMarkup()
            button = types.InlineKeyboardButton("–ú–æ—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞", callback_data="ref_structure")
            button2 = types.InlineKeyboardButton("–ü–µ—Ä–µ–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤", callback_data="transfer_balance")
            button3 = types.InlineKeyboardButton("–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥", callback_data="return_balance")
            button4 = types.InlineKeyboardButton("–°–º–µ–Ω–∏—Ç—å —Å–ø–æ–Ω—Å–æ—Ä–∞", callback_data="change_sponsor")
            markup.add(button, button2, button3, button4, row_width=1)
            
            bot.send_message(call.from_user.id, f"""
–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ, –ø—Ä–∏–≥–ª–∞—à–∞—è –¥—Ä—É–∑–µ–π –≤ –ø—Ä–æ–µ–∫—Ç '–ó–∞ –ª—é–±–æ–≤—å'! –ù–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∞–º –ø–æ–ª—É—á–∞—Ç—å –¥–æ—Ö–æ–¥ –æ—Ç –ø–æ–¥–ø–∏—Å–æ–∫, –∏–≥—Ä –∏ —Å–æ –≤—Å–µ—Ö –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–º–∏ –¥–µ–ª—è—Ç—Å—è –≤–∞—à–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã–µ. –ß–µ–º –±–æ–ª—å—à–µ –≤–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞, —Ç–µ–º –≤—ã—à–µ –≤–∞—à –∑–∞—Ä–∞–±–æ—Ç–æ–∫ ‚Äî –¥–æ 20 —É—Ä–æ–≤–Ω–µ–π –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–æ–π —Å–µ—Ç–∏. –ü–æ–ª—É—á–∏—Ç–µ —Å–≤–æ—é —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É, —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –±–∞–ª–∞–Ω—Å–æ–º –∏ —Å—Ç—Ä–æ–π—Ç–µ —Å–≤–æ—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É–∂–µ —Å–µ–≥–æ–¥–Ω—è!

–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ (–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å): 

<code>https://t.me/forlove2025_bot?start={call.from_user.id}</code>

–ú–æ–π —Å–ø–æ–Ω—Å–æ—Ä:
@{get_user_ref(session, user).username}

–ë–æ–Ω—É—Å–Ω—ã–π –±–∞–ª–∞–Ω—Å:
{user.balance} ‚ÇΩ

–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å:
{user.inner_balance} ‚ÇΩ
                             """, reply_markup=markup, parse_mode="html")
        elif call.data == "ref_structure":
            ref_users = session.execute(select(User).where(User.ref == user.tg_id)).scalars().all() # —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
            nicks = """"""
            for ref in ref_users:
                nicks += f"@{ref.username}\n"
            
            users = session.execute(select(User).where(User.ref == user.tg_id)).scalars().all()
            line_users = []
            text_line = ""
            for i in range(0, 20):
                line_users.append(len(users))
                if len(users) != 0: text_line += f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ {i + 1} –ª–∏–Ω–∏–∏: {len(users)}\n"
                users = get_list_refs(session, users)
            print(line_users)
            bot.send_message(call.from_user.id, f"""
–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫ —Ä–∞—Å—Ç–µ—Ç –≤–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞! –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ —É–≤–∏–¥–µ—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤–∞—à–µ–π –ø–µ—Ä–≤–æ–π –ª–∏–Ω–∏–∏, —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤ –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –≤–º–µ—Å—Ç–µ!

{text_line}

–í–∞—à–∞ 1-—è –ª–∏–Ω–∏—è:
{nicks}   
                             """)
        elif call.data == "return_balance":
            bot.send_message(call.from_user.id, "–°–∫–æ—Ä–æ —Å –≤–∞–º–∏ —Å–≤—è–∂–µ—Ç—Å—è –Ω–∞—à –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å")
            bot.send_message(ADMIN_CHAT_ID, f"–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ –æ—Ç @{user.username} (–µ–≥–æ –±–∞–ª–∞–Ω—Å - {user.balance} ‚ÇΩ)", message_thread_id=6)
        elif call.data == "transfer_balance":
            bot.send_message(call.from_user.id, "–í—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ —Å –±–æ–Ω—É—Å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞. –ù–∞–ø–∏—à–∏—Ç–µ –Ω–∏–∫ –∫–æ–º—É –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ (–≤ —Ñ–æ—Ä–º–∞—Ç–µ @–Ω–∏–∫)")
            bot.register_next_step_handler(call.message, transfer_balance_1, bot)
        
        elif call.data == "change_sponsor":
            bot.send_message(call.from_user.id, f"–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∏–∫ –ø–æ–¥ –∫–æ–≥–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ (–≤ —Ñ–æ—Ä–º–∞—Ç–µ @–Ω–∏–∫)")
            bot.register_next_step_handler(call.message, change_sponsor_1, bot)
        # –ü–û–î–î–ï–†–ñ–ö–ê
        elif call.data == "support":
            markup = types.InlineKeyboardMarkup()
            button = types.InlineKeyboardButton("–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É", callback_data="support_message")
            markup.add(button)
            bot.send_message(call.from_user.id, "–£ –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å? –ú—ã –≤—Å–µ–≥–¥–∞ —Ä—è–¥–æ–º!\n\n–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º, —Ä–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –≤–∞—à–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –∏–ª–∏ –∑–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å, –∏ –Ω–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ—Ç–≤–µ—Ç–∏—Ç –≤ –∫—Ä–∞—Ç—á–∞–π—à–∏–µ —Å—Ä–æ–∫–∏. –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–æ—Ç–æ, —á—Ç–æ–±—ã –º—ã –ª—É—á—à–µ –ø–æ–Ω—è–ª–∏ –≤–∞—à –∑–∞–ø—Ä–æ—Å. –î–∞–≤–∞–π—Ç–µ —Å–¥–µ–ª–∞–µ–º –≤–∞—à –æ–ø—ã—Ç —Å '–ó–∞ –ª—é–±–æ–≤—å' –Ω–µ–∑–∞–±—ã–≤–∞–µ–º—ã–º!", reply_markup=markup)
        elif call.data == "support_message":
            bot.send_message(call.from_user.id, "–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É")
            bot.register_next_step_handler(call.message, support_message, bot)
            
    bot.answer_callback_query(call.id)  # –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –æ—Ç–∫—Ä—ã–ª–∏—Å—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –Ω–∞—à–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã      
    
def support_message(message: types.Message, bot: TeleBot):
    bot.send_message(message.chat.id, "–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É")
    bot.send_message(ADMIN_CHAT_ID, f"""
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å @{message.from_user.username} –æ—Ç–ø—Ä–∞–≤–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É:

{message.text}
                     """, message_thread_id=7)
def change_sponsor_1(message: types.Message, bot: TeleBot):
    if message.text == "–ù–∞ –≥–ª–∞–≤–Ω—É—é":
        handle_start_message(bot, message.chat.id)
        return
    new_sponsor = message.text[1:]
    bot.send_message(message.chat.id, "–í—ã —Ç–æ—á–Ω–æ —É–≤–µ—Ä–µ–Ω—ã –≤ —Å–º–µ–Ω–µ —Å–ø–æ–Ω—Å–æ—Ä–∞? –í–≤–µ–¥–∏—Ç–µ ¬´–î–∞¬ª")
    bot.register_next_step_handler(message, change_sponsor_2, bot, new_sponsor)
def change_sponsor_2(message: types.Message, bot: TeleBot, new_sponsor: str):
    if message.text == "–ù–∞ –≥–ª–∞–≤–Ω—É—é": 
        handle_start_message(bot, message.chat.id)
        return
    
    if "–¥–∞" in message.text.lower():
        with Session(engine) as session:
            ref_user = session.execute(select(User).where(User.username == new_sponsor)).scalar()
            if ref_user == None: 
                bot.send_message(message.chat.id, "–°–ø–æ–Ω—Å–æ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω.")
                #bot.send_message(message.chat.id, f"–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∏–∫ –ø–æ–¥ –∫–æ–≥–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ (–≤ —Ñ–æ—Ä–º–∞—Ç–µ @–Ω–∏–∫)")
                #bot.register_next_step_handler(message, change_sponsor_1, bot)
                return
            bot.send_message(message.chat.id, "–°–ø–æ–Ω—Å–æ—Ä —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω")
            user = session.execute(select(User).where(User.tg_id == message.from_user.id)).scalar()
            user.ref = ref_user.tg_id
            session.commit()
                
    else:
        bot.send_message(message.chat.id, "–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–ø–æ–Ω—Å–æ—Ä–∞ –æ—Ç–º–µ–Ω–µ–Ω–æ")

def transfer_balance_1(message: types.Message, bot: TeleBot):
    if message.text == "–ù–∞ –≥–ª–∞–≤–Ω—É—é": 
        handle_start_message(bot, message.chat.id)
        return
    if '–æ—Ç–º–µ–Ω–∞' in message.text.lower():
        bot.send_message(message.chat.id, "–û—Ç–ø—Ä–∞–≤–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞")
        return
    with Session(engine) as session:
        balance_get_user = session.execute(select(User).where(User.username == message.text[1:])).scalar()
        if balance_get_user == None:
            bot.send_message(message.chat.id, "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω")
        else:
            bot.send_message(message.chat.id, f"–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –∫–æ—Ç–æ—Ä—É—é –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –∫ @{balance_get_user.username}")
            bot.register_next_step_handler(transfer_balance_2, bot, message.text[1:])
def transfer_balance_2(message: types.Message, bot: TeleBot, username: str):
    with Session(engine) as session:
        balance_get_user = session.execute(select(User).where(User.username == username)).scalar()
        user = session.execute(select(User).where(User.tg_id == message.from_user.id)).scalar()
        try: 
            number = int(message.text)
            if user.balance < number: 
                bot.send_message(message.chat.id, "–ù–∞ –±–∞–ª–∞–Ω—Å–µ –º–µ–Ω—å—à–µ –≤–≤–µ–¥–µ–Ω–æ–π —Å—É–º–º—ã")
                return
        except: bot.send_message(message.chat.id, "–ù–∞ –±–∞–ª–∞–Ω—Å–µ –º–µ–Ω—å—à–µ –≤–≤–µ–¥–µ–Ω–æ–π —Å—É–º–º—ã")
        balance_get_user.balance += number
        user.balance -= number
        session.commit()
        transfer = BalanceTransfer(
            from_user_id = user.id,
            to_user_id = balance_get_user.id,
            money = number
        )
        session.add(transfer)
        session.commit()
        bot.send_message(message.chat.id, f"–£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ {number} ‚ÇΩ –Ω–∞ –±–∞–ª–∞–Ω—Å @{balance_get_user.username}")
        bot.send_message(balance_get_user.tg_id, f"–í—ã –ø–æ–ª—É—á–∏–ª–∏ {number} ‚ÇΩ –Ω–∞ –±–∞–ª–∞–Ω—Å –æ—Ç @{user.username}")


# ‚ÇΩ